{% extends 'base.html' %}

{% block title %}Agregar Productos{% endblock %}

{% block css %}

    <link rel="stylesheet" href="{{url_for('static',filename='css/forms.css')}}">
    <link rel="stylesheet" href="{{url_for('static',filename='css/modal.css')}}">

{% endblock %}

{% block content %}
<form id="form_add_producto" action="{{url_for('add_producto')}}" method="post" >
    <div class="form-container">
    <!-- Elegir Fruta o Verdura OBLIGATORIO --> 
    <label>Tipo de Producto :<br></label required>
    <select id="tipo" name="tipo">
        <option value="fruta"> fruta </option>
        <option value="verdura"> verdura </option>
    </select>
    <!-- Elegir los productos que va a presentar OBLIGATORIO--> 
    <label> Producto : </label>
    <select multiple id="producto_selector" name="producto_selector" required> 
        <!-- Esto se rellena con el script de abajo -->
    </select>
    <!-- Descripcion de los productos OPCIONAL--> 
    <label> Descripcion : <br></label>
    <textarea id="descripcion" name="descripcion" rows="4" cols="50"></textarea><br>
    <!-- Subir archivos OBLIGATORIO --> 
    <label> Imagen del Producto : <br></label>

        <input type="file" id="file_1" name="myfile" required>
        <input type="file" id="file_2" name="myfile">
        <input type="file" id="file_3" name="myfile">

    <!-- Seleccionar region OBLIGATORIO-->
    <label><br> Region : </label>
    <select id="region_selector" name="region_selector" required>
        {% for region in regiones %}
            <option value="{{ region }}"> {{ region }} </option>
        {% endfor %}
    </select>
    <!-- Comunas OBLIGATORIO --> 
    <label> Comunas : </label>
    <select id="comunas" name="comunas" required > 
        <!-- Esto se rellena con el script de abajo -->
    </select>  
    <!-- Nombre Productor OBLIGATORIO--> 
        <label > Nombre Productor : <br></label>
        <input type="text" id="name" name="name" size="80" required>
    <!-- Email Contacto OBLIGATORIO --> 
        <label > Email : <br></label>
        <input type="text" id="email" name="email" size="30" required><br>
    <!-- Numero Celular Productor OPCIONAL --> 
        <label > Teléfono : <br></label>
        <input type="text" id="phone" name="phone" size="15" required>
    <br><br>
    <button type="submit" form="form_add_producto">  Agregar Producto (s)</button>
    </div>
</form>
    <!-- Modal para el mensaje de confirmacion -->
    <div id="myModal" class="modal">
        <div class="modal-content">
          <p>¿Confirma el registro de este producto?</p>
          <button id="confirmarBtn">Sí, confirmo</button>
          <button id="cancelarBtn">No, quiero volver al formulario</button>
        </div>
    </div>

{% endblock content %}

{% block javascript %}

<script>
    // Script para rellenar y actualizar los productos
    var productosPorTipo = {{ productos | tojson }};
    var tipoSelector = document.getElementById('tipo');
    var productoSelector = document.getElementById('producto_selector');

    tipoSelector.addEventListener('change', function() {
        var selectedTipo = tipoSelector.value;
        productoSelector.innerHTML = '';

        var productos = productosPorTipo[selectedTipo];

        productos.forEach(function(producto) {
            var option = document.createElement('option');
            option.value = producto;
            option.textContent = producto;
            productoSelector.appendChild(option);
        });
    });

    tipoSelector.dispatchEvent(new Event('change'));
    // Script para rellenar y actualizar las comunas

    let comunasPorRegion = {{ comunas_por_region | tojson }};

    let regionSelector = document.getElementById('region_selector');
    let comunasSelect = document.getElementById('comunas');

    regionSelector.addEventListener('change', function() {
        let selectedRegion = regionSelector.value;
        comunasSelect.innerHTML = '';

        let comunas = comunasPorRegion[selectedRegion];

        comunas.forEach(function(comuna) {
            let option = document.createElement('option');
            option.value = comuna;
            option.textContent = comuna;
            comunasSelect.appendChild(option);
        });
    });

    regionSelector.dispatchEvent(new Event('change'));
    
</script>

{% endblock %}